<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-04-09">

<title>Lab 7 – 432-2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">432-2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./calendar.html"> 
<span class="menu-text">Calendar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://thomaselove.github.io/432-syllabus-2025/"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./notes.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/THOMASELOVE/432-data"> 
<span class="menu-text">Get Data</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="./lab1.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab2.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab3.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab4.html">
 <span class="dropdown-text">Lab 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab5.html">
 <span class="dropdown-text">Lab 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab6.html">
 <span class="dropdown-text">Lab 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab7.html">
 <span class="dropdown-text">Lab 7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./projA.html">
 <span class="dropdown-text">Project A</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projB.html">
 <span class="dropdown-text">Project B</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quizzes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Quizzes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quizzes">    
        <li>
    <a class="dropdown-item" href="./quiz1.html">
 <span class="dropdown-text">Quiz 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./quiz2.html">
 <span class="dropdown-text">Quiz 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/THOMASELOVE/432-sources"> 
<span class="menu-text">Sources</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-key-links" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Key Links</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-key-links">    
        <li>
    <a class="dropdown-item" href="https://campuswire.com/">
 <span class="dropdown-text">Campuswire discussion board</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://canvas.case.edu/">
 <span class="dropdown-text">Canvas (submissions &amp; recordings)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://drive.google.com/drive/u/1/folders/0AJiAzE5flLrYUk9PVA">
 <span class="dropdown-text">Shared Google Drive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/THOMASELOVE/432-classes-2025">
 <span class="dropdown-text">Class READMEs (Github)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./contact.html"> 
<span class="menu-text">Contact Us</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-instructions" id="toc-general-instructions" class="nav-link active" data-scroll-target="#general-instructions">General Instructions</a>
  <ul class="collapse">
  <li><a href="#template" id="toc-template" class="nav-link" data-scroll-target="#template">Template</a></li>
  <li><a href="#our-best-advice" id="toc-our-best-advice" class="nav-link" data-scroll-target="#our-best-advice">Our Best Advice</a></li>
  <li><a href="#r-packages-used-in-the-answer-sketch" id="toc-r-packages-used-in-the-answer-sketch" class="nav-link" data-scroll-target="#r-packages-used-in-the-answer-sketch">R Packages used in the Answer Sketch</a></li>
  <li><a href="#r-packages-and-setup" id="toc-r-packages-and-setup" class="nav-link" data-scroll-target="#r-packages-and-setup">R Packages and Setup</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  </ul></li>
  <li><a href="#question-1.-14-points" id="toc-question-1.-14-points" class="nav-link" data-scroll-target="#question-1.-14-points">Question 1. (14 points)</a></li>
  <li><a href="#question-2.-12-points" id="toc-question-2.-12-points" class="nav-link" data-scroll-target="#question-2.-12-points">Question 2. (12 points)</a></li>
  <li><a href="#question-3.-12-points" id="toc-question-3.-12-points" class="nav-link" data-scroll-target="#question-3.-12-points">Question 3. (12 points)</a></li>
  <li><a href="#question-4.-12-points" id="toc-question-4.-12-points" class="nav-link" data-scroll-target="#question-4.-12-points">Question 4. (12 points)</a></li>
  <li><a href="#use-of-ai" id="toc-use-of-ai" class="nav-link" data-scroll-target="#use-of-ai">Use of AI</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session Information</a></li>
  <li><a href="#after-the-lab" id="toc-after-the-lab" class="nav-link" data-scroll-target="#after-the-lab">After the Lab</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 7</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-04-09</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="general-instructions" class="level1">
<h1>General Instructions</h1>
<ul>
<li>Submit your work via <a href="https://canvas.case.edu/">Canvas</a>.</li>
<li>The deadline for this Lab is specified on the <a href="./calendar.html">Course Calendar</a>.
<ul>
<li>For this lab, we will charge a 5 point penalty for a lab that is 1-24 hours late.</li>
<li>We will charge a 15 point penalty for a response that is more than 24 but less than 48 hours late.</li>
<li>We do not grade work that is more than 48 hours late.</li>
</ul></li>
<li>Your response should include a Quarto file (.qmd) and an HTML document that is the result of applying your Quarto file to the data we’ve provided.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>All students must complete both Lab 6 and Lab 7. Neithert can be “skipped”.</p>
</div>
</div>
<section id="template" class="level2">
<h2 class="anchored" data-anchor-id="template">Template</h2>
<p>You should be able to modify the <a href="https://raw.githubusercontent.com/THOMASELOVE/432-data/refs/heads/master/data/432_lab3_template.qmd">Lab 3 Quarto template</a> available on <a href="https://github.com/THOMASELOVE/432-data">our 432-data page</a> to help you do this Lab.</p>
</section>
<section id="our-best-advice" class="level2">
<h2 class="anchored" data-anchor-id="our-best-advice">Our Best Advice</h2>
<p>Review your HTML output file carefully before submission for copy-editing issues (spelling, grammar and syntax.) Even with spell-check in RStudio (just hit F7), it’s hard to find errors with these issues in your Quarto file so long as it is running. You really need to look closely at the resulting HTML output.</p>
</section>
<section id="r-packages-used-in-the-answer-sketch" class="level2">
<h2 class="anchored" data-anchor-id="r-packages-used-in-the-answer-sketch">R Packages used in the Answer Sketch</h2>
<p>In my answer sketch for Lab 7, I used the following setup. You are welcome to do the same.</p>
</section>
<section id="r-packages-and-setup" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="r-packages-and-setup">R Packages and Setup</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that my list of R packages does not include separate loading of any of the core <strong>tidyverse</strong> packages, or the packages in the <strong>easystats</strong> framework. The core <strong>tidyverse</strong> packages are listed at <a href="https://www.tidyverse.org/packages/#core-tidyverse" class="uri">https://www.tidyverse.org/packages/#core-tidyverse</a>, and the packages in the <strong>easystats</strong> framework are listed at <a href="https://easystats.github.io/easystats/" class="uri">https://easystats.github.io/easystats/</a>. If you separately load any of these packages, you will lose points on this Lab. Same goes for Projects A and B.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment =</span> <span class="cn">NA</span>) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(topmodels)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_dark</span>()) </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(base<span class="sc">::</span>max, base<span class="sc">::</span>mean, stats<span class="sc">::</span>cor, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                 dplyr<span class="sc">::</span>filter, dplyr<span class="sc">::</span>select, dplyr<span class="sc">::</span>summarize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<ul>
<li>The <code>chr_2015.csv</code> csv file (from <a href="./lab1.html">Lab 1</a>), <code>hbp3024.xlsx</code> Excel file (from <a href="./lab2.html">Lab 2</a>), <code>nh_1500.Rds</code> R data set (from <a href="./lab3.html">Lab 3</a>) and the <code>remit48.sav</code> SPSS file all appear on the <a href="https://github.com/THOMASELOVE/432-data">432 data page</a>.</li>
<li>A detailed codebook for all of the data in the <code>chr_2015</code> file <a href="./chr_codebook.html">is available here</a>.</li>
<li>A detailed description of each variable in the <code>hbp3024</code> data is <a href="./hbp_codebook.html">available here</a>.</li>
<li>A detailed description of each variable in the <code>nh_1500</code> data is <a href="./nhanes_codebook.html">available here</a>.</li>
<li>The variables included in the <code>remit48</code> data are described in Question 4, below.</li>
</ul>
</section>
</section>
<section id="question-1.-14-points" class="level1">
<h1>Question 1. (14 points)</h1>
<p>Use the <code>chr_2015</code> data to build a model to predict each county’s percentage of the population ages 16 and older who are unemployed but seeking work, as measured in 2013 (and reported in CHR 2015). Note that each of the values in the data are integers (that fall between 1 and 28), and so we will treat the <code>unemp</code> values as counts in Question 1. You will produce a Poisson regression model for <code>unemp</code> using the main effects of two quantitative predictors: the county’s food environment index and the county’s adult obesity rate.</p>
<ol type="a">
<li>{5} Produce the Poisson regression model, which I’ll call <code>mod1</code>, then interpret the coefficient (the point estimate is sufficient) for the <code>food_env</code> variable. Finally, provide a 90% confidence interval for the point estimate you provide. Round your estimates to two decimal places.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In stating your response to Question 1a, you can choose whether or not to exponentiate the coefficient’s estimate and its confidence interval. So long as you interpret the result you present correctly, we will be happy with either, but there is no need to present both the exponentiated and unexponentiated results.</p>
</div>
</div>
<ol start="2" type="a">
<li>{5} Produce and interpret the meaning of a rootogram for <code>mod1</code>, and specify the model’s <span class="math inline">\(R^2\)</span> value, rounded to three decimal places.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In stating your response to Question 1b, you can choose whether you want to show the Nagelkerke <span class="math inline">\(R^2\)</span>, or the squared correlation of the observed and model-predicted outcome values.</p>
</div>
</div>
<ol start="3" type="a">
<li>{4} Use <code>mod1</code> to make a prediction of the <code>unemp</code> rate (rounded to two decimal places) for Cuyahoga County, in Ohio, based on Cuyahoga’s values for <code>food_env</code> (6.7) and for <code>obesity</code> (28) and then, in a complete sentence, compare the <code>mod1</code> prediction to the observed <code>unemp</code> rate for Cuyahoga County as reported in 2013 as part of CHR 2015.</li>
</ol>
</section>
<section id="question-2.-12-points" class="level1">
<h1>Question 2. (12 points)</h1>
<p>Import the data from the <code>hbp_3024.xlsx</code> file into R, being sure to include NA as a potential missing value when you do, since all missing values are indicated in the Excel file with NA. Next, create a data set I’ll call <code>lab5q2</code>, which:</p>
<ul>
<li>restricts the <code>hbp_3024</code> data to only the 1296 subjects who were seen in one of three practices, specifically: <strong>Center</strong>, <strong>King</strong> or <strong>Plympton</strong>, and</li>
<li>includes only those 1284 subjects from those three practices with complete data on the three variables we will study in Question 2, specifically <code>income</code>, <code>insurance</code> and <code>practice</code>, and which</li>
<li>includes a new variable called <code>s_income</code>, which rescales the <code>income</code> data to have mean 0 and standard deviation 1.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The rescaling would be facilitated by including code using the <code>scale()</code> function. My code, for instance, includes the following …</p>
<p><code>s_income = scale(income, center = TRUE, scale = TRUE)</code></p>
</div>
</div>
<ol type="a">
<li><p>{6} Using your <code>lab5q2</code> data set, build a multinomial logistic regression model, called <code>fit2</code> to predict <code>practice</code> (a nominal categorical outcome) for each of the 1284 subjects on the basis of main effects of the subject’s <code>insurance</code> and (re-scaled) <code>s_income</code>. Show R code which displays the coefficients of the model you fit, and their 90% confidence intervals. Then use the model you fit to estimate the log odds of a subject’s practice being Plympton rather than Center for a subject with Medicare insurance whose <code>income</code> is at the mean across our sample. Round the resulting log odds estimate to two decimal places.</p></li>
<li><p>{6} Now use the model <code>fit2</code> you fit in Question 2 part a to produce a classification table for the 1284 subjects in your data which compares their actual <code>practice</code> to their predicted <code>practice</code>. Then, in a complete sentence or two, specify both the percentage of correct classifications overall, and also identify the <code>practice</code> that is most often mis-classified by your model.</p></li>
</ol>
</section>
<section id="question-3.-12-points" class="level1">
<h1>Question 3. (12 points)</h1>
<p>Use the <code>nh_1500</code> data to predict self-reported overall health (which is a five-category ordinal categorical outcome) on the basis of the subject’s age, waist circumference, and whether or not they have smoked 100 cigarettes in their lifetime. On 2025-03-01, I updated the <code>nh_1500</code> data to save the <code>health</code> variable as an <em>ordered</em> factor. You’ll want to ensure that’s what you see when you pull in the data.</p>
<ol type="a">
<li><p>{6} Produce two proportional odds logistic regression models. The first, which I’ll call <code>mod3a</code>, should use all three predictors to predict <code>health</code>, while the second model, called <code>mod3b</code>, should use only two predictors, leaving out age. For each model, write R code to display the exponentiated coefficient estimates, along with 90% confidence intervals. Then, for <code>mod3a</code>, write a sentence (or two) where you interpret the meaning of the point estimate (after exponentiating) for waist circumference, and also specify its 90% confidence interval.</p></li>
<li><p>{6} Validate the C statistic and Nagelkerke <span class="math inline">\(R^2\)</span> for each of your models using a bootstrap procedure with 300 iterations and a seed set to <code>2025</code>. Specify your conclusion about which model looks better on the basis of this work.</p></li>
</ol>
</section>
<section id="question-4.-12-points" class="level1">
<h1>Question 4. (12 points)</h1>
<p>The <code>remit48.sav</code> gathers initial remission times, in days (the variable is called <code>days</code>) for 48 adult subjects with a leukemia diagnosis who were randomly allocated to one of two different <code>treatment</code>s, labeled Old and New. Some patients were right-censored before their remission times could be fully determined, as indicated by values of <code>censored</code> = “Yes” in the data set. Note that remission is a good thing, so long times before remission are bad.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is my code for creating the necessary tibble, which I called <code>lab5q4</code>.</p>
<pre><code>lab5q4 &lt;- read_spss(here("data/remit48.sav")) 

lab5q4$treatment |&gt; attr("label")
lab5q4$censored |&gt; attr("label")

lab5q4 &lt;- lab5q4 |&gt;
  mutate(treatment = 
           fct_recode(factor(treatment), "New" = "1", "Old" = "2"),
         censored = 
           fct_recode(factor(censored), "No" = "1", "Yes" = "2"),
         subject = as.character(subject)) |&gt;
  zap_labels()</code></pre>
<p>Be sure a glimpse at your <code>lab5q4</code> produces the following:</p>
<pre><code>&gt; glimpse(lab5q4)

Rows: 48
Columns: 4
$ subject   &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", …
$ treatment &lt;fct&gt; New, New, Old, New, New, Old, Old, Old, New, New, …
$ days      &lt;dbl&gt; 269, 139, 161, 9, 31, 199, 19, 20, 28, 29, …
$ censored  &lt;fct&gt; Yes, No, Yes, No, No, Yes, No, No, No, No, …</code></pre>
</div>
</div>
<ol type="a">
<li><p>{6} Plot appropriate Kaplan-Meier estimates of the survival functions for each of the two treatments in a single plot. Create a table that shows the restricted mean and median for survival time in days for the two treatment groups. In a sentence or two, what conclusions can you draw from your plot and table?</p></li>
<li><p>{6} Use a Cox proportional hazards model to compare the two treatments, specifying the relevant point and 90% confidence intervals estimates of the hazard ratio, and describing the meaning of the point estimate.</p></li>
</ol>
</section>
<section id="use-of-ai" class="level1">
<h1>Use of AI</h1>
<p>If you decide to use some sort of AI to help you with this Lab, we ask that you place a note to that effect, describing what you used and how you used it, as a separate section called “Use of AI”, after your answers to our questions, and just <em>before</em> your presentation of the Session Information. Thank you.</p>
</section>
<section id="session-information" class="level1">
<h1>Session Information</h1>
<p>Please display your session information at the end of your submission in a separate section of its own, as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.3 (2025-02-28 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26100)

Locale:
  LC_COLLATE=English_United States.utf8 
  LC_CTYPE=English_United States.utf8   
  LC_MONETARY=English_United States.utf8
  LC_NUMERIC=C                          
  LC_TIME=English_United States.utf8    

Package version:
  abind_1.4-8           askpass_1.2.1         backports_1.5.0      
  base64enc_0.1-3       bayestestR_0.15.2     bigD_0.3.0           
  bit_4.6.0             bit64_4.6.0.1         bitops_1.0.9         
  blob_1.2.4            boot_1.3.31           broom_1.0.7          
  bslib_0.9.0           cachem_1.1.0          callr_3.7.6          
  car_3.1-3             carData_3.0-5         cellranger_1.1.0     
  checkmate_2.3.2       cli_3.6.4             clipr_0.8.0          
  cluster_2.1.8         coda_0.19-4.1         codetools_0.2-20     
  colorspace_2.1-1      commonmark_1.9.5      compiler_4.4.3       
  conflicted_1.2.0      correlation_0.8.7     corrplot_0.95        
  cowplot_1.1.3         cpp11_0.5.2           crayon_1.5.3         
  curl_6.2.1            data.table_1.17.0     datasets_4.4.3       
  datawizard_1.0.1      DBI_1.2.3             dbplyr_2.5.0         
  Deriv_4.1.6           digest_0.6.37         distributions3_0.2.2 
  doBy_4.6.25           dplyr_1.1.4           dtplyr_1.3.1         
  easystats_0.7.4       effectsize_1.0.0      emmeans_1.11.0       
  estimability_1.5.1    evaluate_1.0.3        exactRankTests_0.8.35
  fansi_1.0.6           farver_2.1.2          fastmap_1.2.0        
  fontawesome_0.5.3     forcats_1.0.0         foreign_0.8-88       
  Formula_1.2-5         fs_1.6.5              gargle_1.5.2         
  generics_0.1.3        ggformula_0.12.0      ggplot2_3.5.1        
  ggpubr_0.6.0          ggrepel_0.9.6         ggridges_0.5.6       
  ggsci_3.2.0           ggsignif_0.6.4        ggtext_0.1.2         
  glue_1.8.0            googledrive_2.1.1     googlesheets4_1.1.1  
  graphics_4.4.3        grDevices_4.4.3       grid_4.4.3           
  gridExtra_2.3         gridtext_0.1.5        gt_0.11.1            
  gtable_0.3.6          hardhat_1.4.1         haven_2.5.4          
  here_1.0.1            highr_0.11            Hmisc_5.2-3          
  hms_1.1.3             htmlTable_2.4.3       htmltools_0.5.8.1    
  htmlwidgets_1.6.4     httr_1.4.7            ids_1.0.1            
  insight_1.1.0         isoband_0.2.7         janitor_2.2.1        
  jpeg_0.1.11           jquerylib_0.1.4       jsonlite_1.9.1       
  juicyjuice_0.1.0      km.ci_0.5-6           KMsurv_0.1-5         
  knitr_1.50            labeling_0.4.3        labelled_2.14.0      
  lattice_0.22-6        lifecycle_1.0.4       lme4_1.1.36          
  lubridate_1.9.4       magrittr_2.0.3        markdown_1.13        
  MASS_7.3-65           Matrix_1.7-2          MatrixModels_0.5-3   
  maxstat_0.7.25        memoise_2.0.1         methods_4.4.3        
  mgcv_1.9.1            microbenchmark_1.5.0  mime_0.13            
  minqa_1.2.8           modelbased_0.10.0     modelr_0.1.11        
  mosaic_1.9.1          mosaicCore_0.9.4.0    mosaicData_0.20.4    
  multcomp_1.4-28       munsell_0.5.1         mvtnorm_1.3-3        
  naniar_1.1.0          nlme_3.1-167          nloptr_2.2.1         
  nnet_7.3-20           norm_1.0.11.1         numDeriv_2016.8.1.1  
  openssl_2.3.2         parallel_4.4.3        parameters_0.24.2    
  patchwork_1.3.0       pbkrtest_0.5.3        performance_0.13.0   
  pillar_1.10.1         pkgconfig_2.0.3       plyr_1.8.9           
  png_0.1.8             polspline_1.1.25      polynom_1.4.1        
  prettyunits_1.2.0     processx_3.8.6        progress_1.2.3       
  ps_1.9.0              purrr_1.0.4           quantreg_6.1         
  R6_2.6.1              ragg_1.3.3            rappdirs_0.3.3       
  rbibutils_2.3         RColorBrewer_1.1.3    Rcpp_1.0.14          
  RcppEigen_0.3.4.0.2   Rdpack_2.6.3          reactable_0.4.4      
  reactR_0.6.1          readr_2.1.5           readxl_1.4.5         
  reformulas_0.4.0      rematch_2.0.0         rematch2_2.1.2       
  report_0.6.1          reprex_2.1.1          rlang_1.1.5          
  rmarkdown_2.29        rms_7.0-0             rpart_4.1.24         
  rprojroot_2.0.4       rstatix_0.7.2         rstudioapi_0.17.1    
  rvest_1.0.4           sandwich_3.1-1        sass_0.4.9           
  scales_1.3.0          see_0.11.0            selectr_0.4.2        
  snakecase_0.11.1      SparseM_1.84-2        sparsevctrs_0.3.2    
  splines_4.4.3         stats_4.4.3           stringi_1.8.4        
  stringr_1.5.1         survival_3.8-3        survminer_0.5.0      
  survMisc_0.5.6        sys_3.4.3             systemfonts_1.2.1    
  textshaping_1.0.0     TH.data_1.1-3         tibble_3.2.1         
  tidyr_1.3.1           tidyselect_1.2.1      tidyverse_2.0.0      
  timechange_0.3.0      tinytex_0.56          tools_4.4.3          
  topmodels_0.3-0       tzdb_0.5.0            UpSetR_1.4.0         
  utf8_1.2.4            utils_4.4.3           uuid_1.2.1           
  V8_6.0.2              vctrs_0.6.5           viridis_0.6.5        
  viridisLite_0.4.2     visdat_0.6.0          vroom_1.6.5          
  withr_3.0.2           xfun_0.51             xml2_1.3.8           
  xtable_1.8-4          yaml_2.3.10           yardstick_1.3.2      
  zoo_1.8-13           </code></pre>
</div>
</div>
</section>
<section id="after-the-lab" class="level1">
<h1>After the Lab</h1>
<ul>
<li>We will post an answer sketch to our Shared Google Drive 48 hours after the Lab is due.</li>
<li>We will post grades to our Grading Roster on our Shared Google Drive one week after the Lab is due.</li>
<li>See the Lab Appeal Policy in <a href="https://thomaselove.github.io/432-syllabus-2025/08-grading.html">Section 8.5 of our Syllabus</a> if you are interested in having your Lab 1, 2, 3, 4, 5 or 7 grade reviewed, and use the <a href="https://bit.ly/432-2025-lab-regrades">Lab Regrade Request form</a> to complete the task. The form (which is optional) is due when the <a href="./calendar.html">Calendar</a> says it is. Thank you.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>